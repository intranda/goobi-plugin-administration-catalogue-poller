<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:p="http://primefaces.org/ui"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <style>
.topAligned {
    vertical-align: top;
    padding-right: 50px;
}
</style>

        <h:outputText
            styleClass="alert alert-danger block margin-top-most"
            value="#{msgs.noAccessAllowed} Plugin_Goobi_DataPoller"
            rendered="#{!LoginForm.hasRole('Plugin_Goobi_DataPoller')}" />

        <h:panelGroup rendered="#{LoginForm.hasRole('Plugin_Goobi_DataPoller')}">
            <div class="row">
                <div class="col-sm-12">
                    <div class="box box-color box-bordered">
                        <div class="box-title">
                            <h3>
                                <i class="fa fa-plug"></i>
                                <h:outputText value="#{myPageTitle}" />
                            </h3>
                        </div>

                        <div class="box-content">
                            <h:form>
                                    <ui:repeat
                                        var="configInfo"
                                        value="#{AdministrationForm.administrationPlugin.cp.configInfo}">
                                        <hr />
                                        <h4>#{configInfo.title}</h4>
                                        
                                        <table
                                            class="table table-hover dataTable table-bordered responsive"
                                            style="margin-top: 10px;">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleFilter}" />
                                                    </th>
                                                    <th style="width:100px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleCatalogue}" />
                                                    </th>
                                                    <th style="width:150px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleCatalogueId}" />
                                                    </th>
                                                    <th style="width:250px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleSkipFields}"
                                                                        rendered="#{'blacklist' eq configInfo.fieldListMode}" />
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleWhitelist}" 
                                                                        rendered="#{'whitelist' eq configInfo.fieldListMode}"/>
                                                    </th>
                                                    <th style="width:150px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleAnalyseSubElements}" />
                                                    </th>
                                                    <th style="width:150px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleMergeRecords}" />
                                                    </th>
                                                    <th style="width:150px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleExportUpdatedRecords}" />
                                                    </th>
                                                    <th style="width:150px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_startingTime}"/>
                                                    </th>
                                                    <th style="width:150px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_ruleDelay}" />
                                                    </th>
                                                    <th style="width:150px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_lastRun}"/>
                                                    </th>
                                                    <th style="width:150px">
                                                        <h:outputText value="#{msgs.plugin_admin_dataPoller_actions}"/>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>#{configInfo.filter}</td>
                                                    <td>#{configInfo.catalogue}</td>
                                                    <td>#{configInfo.searchFields}</td>
                                                    <td>#{configInfo.filterListString}</td>
                                                    <td>
                                                        <h:panelGroup class="badge badge-intranda-red" rendered="#{!configInfo.analyseSubElements}">
                                                            <i class="fa fa-circle-o"></i> #{msgs.inactive}	
                                                        </h:panelGroup>
                                                        <h:panelGroup class="badge badge-intranda-green" rendered="#{configInfo.analyseSubElements}">
                                                            <i class="fa fa-check-circle"></i> #{msgs.active}
                                                        </h:panelGroup>
                                                    </td>
                                                    <td>
                                                        <h:panelGroup class="badge badge-intranda-red" rendered="#{!configInfo.mergeRecords}">
                                                            <i class="fa fa-circle-o"></i> #{msgs.inactive}	
                                                        </h:panelGroup>
                                                        <h:panelGroup class="badge badge-intranda-green" rendered="#{configInfo.mergeRecords}">
                                                            <i class="fa fa-check-circle"></i> #{msgs.active}
                                                        </h:panelGroup>
                                                    </td>
                                                    <td>
                                                        <h:panelGroup class="badge badge-intranda-red" rendered="#{!configInfo.exportUpdatedRecords}">
                                                            <i class="fa fa-circle-o"></i> #{msgs.inactive}	
                                                        </h:panelGroup>
                                                        <h:panelGroup class="badge badge-intranda-green" rendered="#{configInfo.exportUpdatedRecords}">
                                                            <i class="fa fa-check-circle"></i> #{msgs.active}
                                                        </h:panelGroup>
                                                    </td>
                                                    <td>#{configInfo.startTime}</td>
                                                    <td>#{configInfo.delay}</td>
                                                    <td>#{configInfo.lastRun}"</td>
                                                    <td>
	                                               <button class="btn margin-right-5" jsf:rel="tooltip"
                                                        jsf:action="#{AdministrationForm.administrationPlugin.cp.executeTest(configInfo.title)}"
                                                        jsf:disabled="#{not AdministrationForm.administrationPlugin.cp.allowRun}"
                                                        title="#{msgs.plugin_admin_dataPoller_runTest}">
                                                        <i class="fa fa-flask"></i>
                                                        <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                                        <f:passThroughAttribute name="aria-label" value="#{msgs.plugin_admin_dataPoller_runTest}" />
                                                   </button>
                                                    <button class="btn margin-right-5" jsf:rel="tooltip"
                                                        jsf:action="#{AdministrationForm.administrationPlugin.cp.execute(configInfo.title)}"
                                                         jsf:disabled="#{not AdministrationForm.administrationPlugin.cp.allowRun}"
                                                        title="#{msgs.plugin_admin_dataPoller_runNow}">
                                                        <i class="fa fa-play"></i>
                                                        <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                                        <f:passThroughAttribute name="aria-label" value="#{msgs.plugin_admin_dataPoller_runNow}" />
                                                    </button>
                                                    <button class="btn margin-right-5" jsf:rel="tooltip"
                                                        jsf:action="#{AdministrationForm.administrationPlugin.cp.download(configInfo.title)}"
                                                        title="#{msgs.plugin_admin_dataPoller_download}"
                                                        jsf:rendered="#{AdministrationForm.administrationPlugin.cp.reportExists(configInfo.title)}">
                                                        <i class="fa fa-download"></i>
                                                        <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                                        <f:passThroughAttribute name="aria-label" value="#{msgs.plugin_admin_dataPoller_download}" />
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </ui:repeat>
                            </h:form>
                        </div>

                        <h:panelGroup rendered="#{AdministrationForm.administrationPlugin.cp.differences!=null and AdministrationForm.administrationPlugin.cp.differences.size() ne 0}">
                            <div class="box-content">
                                <h4>
                                    <h:outputText value="#{msgs.plugin_admin_dataPoller_resultsTest}" 
                                    rendered="#{AdministrationForm.administrationPlugin.cp.ticketStateTestRun}" />
                                    <h:outputText value="#{msgs.plugin_admin_dataPoller_results}" 
                                    rendered="#{not AdministrationForm.administrationPlugin.cp.ticketStateTestRun}" />
                                    <h:outputText value=" #{msgs.plugin_admin_dataPoller_resultsUnfinished}" 
                                    rendered="#{AdministrationForm.administrationPlugin.cp.ticketStateUnfinished}" />
                                </h4>
                                <ui:repeat
                                    var="pd"
                                    value="#{AdministrationForm.administrationPlugin.cp.differences}">
                                    <hr />
                                    <h:panelGrid
                                        columns="2"
                                        columnClasses="topAligned">
                                        <h:panelGroup>
                                            <h:outputText value="#{msgs.prozess}: #{pd.processTitle}" />
                                            <br />
                                            <h:outputText value="#{msgs.id}: #{pd.processId}" />

                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <ui:repeat
                                                var="mess"
                                                value="#{pd.messages}">
                                                <h:outputText value="#{mess}" />
                                                <br />
                                            </ui:repeat>
                                        </h:panelGroup>
                                    </h:panelGrid>
                                </ui:repeat>
                            </div>
                        </h:panelGroup>
                    </div>
                </div>
            </div>
        </h:panelGroup>
    </composite:implementation>
</ui:composition>